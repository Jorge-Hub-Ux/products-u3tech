<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm">
  <div
    class="w-[min(480px,92vw)] rounded-3xl bg-linear-to-b from-white via-brown-50/70 to-white p-6 shadow-2xl shadow-brown-900/15 ring-1 ring-brown-100"
  >
    <header class="mb-6 flex items-center justify-between gap-3">
      <div>
        <h2 class="text-2xl font-semibold uppercase tracking-[0.2em] text-brown-600">
          Crear Producto
        </h2>
      </div>
      <button
        type="button"
        class="rounded-full border border-transparent bg-brown-100/70 p-2 text-brown-700 transition hover:bg-brown-200 focus:outline-none focus:ring-2 focus:ring-brown-300 focus:ring-offset-2 disabled:opacity-60"
        (click)="onClose()"
        [disabled]="loading()"
        aria-label="Cerrar modal"
      >
        <svg
          aria-hidden="true"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 6l12 12m0-12L6 18" />
        </svg>
      </button>
    </header>

    <form class="space-y-4" (ngSubmit)="onSubmit()" [formGroup]="form">
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-brown-800">Nombre *</label>
        <input
          type="text"
          formControlName="name"
          maxlength="100"
          placeholder="Ej. Taza artesanal"
          class="h-11 rounded-xl border border-brown-100 bg-white px-3 text-sm text-fiord-900 shadow-inner shadow-brown-50 outline-none transition focus:border-brown-400 focus:ring-2 focus:ring-brown-200"
        />
        @if(fieldError('name')){
        <p class="text-xs font-medium text-error-600">
          Nombre requerido (mínimo 3 letras, solo texto).
        </p>
        }
      </div>

      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-brown-800">SKU *</label>
        <input
          type="text"
          formControlName="sku"
          maxlength="40"
          placeholder="Ej. SKU-123"
          class="h-11 rounded-xl border border-brown-100 bg-white px-3 text-sm text-fiord-900 shadow-inner shadow-brown-50 outline-none transition focus:border-brown-400 focus:ring-2 focus:ring-brown-200"
        />
        @if(fieldError('sku')){
        <p class="text-xs font-medium text-error-600">SKU requerido (letras, números y - _ .).</p>
        }
      </div>

      <div class="grid gap-4 sm:grid-cols-2">
        <div class="flex flex-col gap-2">
          <label class="text-sm font-semibold text-brown-800">Precio *</label>
          <div class="relative">
            <span
              class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-sm font-semibold text-brown-500"
              >$</span
            >
            <input
              type="text"
              formControlName="price"
              maxlength="10"
              placeholder="0.00"
              class="h-11 w-full rounded-xl border border-brown-100 bg-white pl-8 pr-3 text-sm text-fiord-900 shadow-inner shadow-brown-50 outline-none transition focus:border-brown-400 focus:ring-2 focus:ring-brown-200"
            />
          </div>
          @if(fieldError('price')){
          <p class="text-xs font-medium text-error-600">
            Ingresa un precio válido (solo números y .).
          </p>
          }
        </div>

        <div class="flex flex-col gap-2">
          <label class="text-sm font-semibold text-brown-800">Stock *</label>
          <input
            type="text"
            maxlength="10"
            formControlName="stock"
            placeholder="0"
            class="h-11 rounded-xl border border-brown-100 bg-white px-3 text-sm text-fiord-900 shadow-inner shadow-brown-50 outline-none transition focus:border-brown-400 focus:ring-2 focus:ring-brown-200"
          />
          @if(fieldError('stock')){
          <p class="text-xs font-medium text-error-600">Ingresa solo números enteros.</p>
          }
        </div>
      </div>

      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-brown-800">Estado *</label>
        <div class="flex gap-3">
          @for(status of statuses; track status.value){
          <button
            type="button"
            (click)="form.get('status')?.setValue(status.value)"
            [class]="
              [
                'flex-1 rounded-xl border px-3 py-2 text-sm font-semibold transition shadow-sm',
                form.value.status === status.value
                  ? 'border-brown-300 bg-brown-100 text-brown-800 shadow-brown-200'
                  : 'border-brown-100 bg-white text-neutral-600 hover:border-brown-200'
              ].join(' ')
            "
          >
            <span class="inline-flex items-center gap-2">
              <span
                class="h-2.5 w-2.5 rounded-full"
                [class]="status.value === 'active' ? 'bg-success-500' : 'bg-error-500'"
              ></span>
              {{ status.label }}
            </span>
          </button>
          }
        </div>
      </div>

      <div class="flex items-center justify-between pt-2">
        <button
          type="button"
          (click)="onClose()"
          class="rounded-xl border border-transparent px-4 py-2 text-sm font-semibold text-brown-700 transition hover:bg-brown-100 focus:outline-none focus:ring-2 focus:ring-brown-300 focus:ring-offset-2"
        >
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="form.invalid || loading()"
          [class.opacity-60]="form.invalid || loading()"
          class="inline-flex items-center justify-center rounded-xl bg-brown-700 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-brown-700/20 transition hover:-translate-y-0.5 hover:bg-brown-800 focus:outline-none focus:ring-2 focus:ring-brown-500 focus:ring-offset-2 disabled:cursor-not-allowed"
        >
          {{ loading() ? 'Agregando...' : 'Agregar Producto' }}
        </button>
      </div>
    </form>
  </div>

  @if (loading()) {
  <div class="fixed inset-0 z-60 flex items-center justify-center bg-white/80 backdrop-blur-sm">
    <div
      class="h-14 w-14 animate-spin rounded-full border-4 border-brown-200 border-t-brown-700"
      aria-label="Cargando"
    ></div>
  </div>
  }
</div>
